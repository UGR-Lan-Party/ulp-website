---
import Pagination from '../components/Pagination.astro';
import Breadcrumb from '../components/layout/Breadcrumb.astro';
import Layout from '../layouts/Layout.astro';
import { getCollection } from "astro:content";

// Filter blog entries with 'draft: false' & date before current date
const publishedBlogEntries = await getCollection("blog", ({ data }) => {
  return !data.draft && data.publishDate < new Date();
});

// Sort content entries by publication date
publishedBlogEntries.sort(function (a, b) {
  return b.data.publishDate.valueOf() - a.data.publishDate.valueOf();
});
---

<Layout
  description="Blog de la UGR LAN Party" 
  title="Blog - UGR LAN Party"
>
  <Breadcrumb>
    <Fragment slot="title">Blog</Fragment>
  </Breadcrumb>
  <section class="pt-20 pb-10 lg:pt-[120px] lg:pb-20 dark:bg-dark">
    <div class="container card-container flex flex-wrap items-center justify-center w-full gap-14">
        {
          publishedBlogEntries.map((blogPostEntry, index) => (
              <a class="wow fadeInUp group block mb-10" data-wow-delay=".1s" href={`/blog/${blogPostEntry.slug}`}>
                <div class="blogCard">
                  <div class="front rounded-[5px] overflow-hidden">
                    <img src={blogPostEntry.data.image.src} 
                    alt={blogPostEntry.data.image.alt}
                    class="w-full h-full object-cover">
                  </div>
                  <div class="back rounded-[5px] p-4 bg-secondary">
                    <h3>
                      <span
                        class="inline-block mb-4 text-xl font-semibold text-dark dark:text-white hover:text-primary dark:hover:text-primary sm:text-2xl lg:text-xl xl:text-2xl"
                      >
                        {blogPostEntry.data.title}
                      </span>
                    </h3>
                    <p class="max-w-[370px] text-base text-body-color dark:text-dark-6">
                      {`${blogPostEntry.data.postDetails.paraOne.slice(0, 150)}...`}
                    </p>
                    <span
                    class="px-2 py-1 mt-10 text-xs font-medium leading-loose text-center text-white rounded-[5px] bg-primary"
                    >
                      {blogPostEntry.data.publishDate.toDateString()}
                    </span>
                  </div>
                </div>
              </a>       
          ))
        }
    </div>
    <Pagination />
  </section>
</Layout>

<style type="text/css">
  .card-container{
    perspective: 1000px;
  }

  .blogCard{
    width: 300px;
    height: 400px;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.6s;
  }

  .front,.back{
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 8px;
    backface-visibility: hidden;
  }

  .front{
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    transform: rotateY(0deg);
  }

  .back{
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    transform: rotateY(180deg);
  }

  a:hover .blogCard{
    transform: rotateY(180deg);
  }
</style>
